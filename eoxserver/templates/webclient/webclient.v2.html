<!--
#-------------------------------------------------------------------------------
# $Id: webclient.html 1653 2012-05-02 10:58:55Z schindlerf $
#
# Project: EOxServer <http://eoxserver.org>
# Authors: Fabian Schindler <fabian.schindler@eox.at>
#          Stephan Krause <stephan.krause@eox.at>
#          Stephan Meissl <stephan.meissl@eox.at>
#
#-------------------------------------------------------------------------------
# Copyright (C) 2012 EOX IT Services GmbH
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell 
# copies of the Software, and to permit persons to whom the Software is 
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies of this Software or works derived from this Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
# THE SOFTWARE.
#-------------------------------------------------------------------------------
-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>EOxServer Webclient</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"></meta>
    <link href="{{STATIC_URL}}OpenLayers/style.css" rel="stylesheet" type="text/css">
    <link href="{{STATIC_URL}}jquery/jquery-ui-1.8.17.custom.css" rel="stylesheet" type="text/css"/>
    <link href="{{STATIC_URL}}jquery/jquery.tooltip.css" rel="stylesheet" type="text/css"/>
    <link href="{{STATIC_URL}}style.css" rel="stylesheet" type="text/css"></link>
  </head>

  <body style="margin:0px;padding:0px;height:100%;width:100%">

<!-- Templates -->
    <script type="text/template" id="tpl-logo">
        <img src="{{STATIC_URL}}EOxServer_logo_small.png" style="align: center;"/>
    </script>
    <script type="text/template" id="tpl-main-control">
        <div id="tabs-main">
            <div class="container">
                <div class="row">
                    <!--<div class="cell">Date:</div>
                    <div class="cell" style="padding: 15px; width: 250px"><div id="slider"></div></div>
                    <div class="cell"><button id="btn-download" /></div>-->
                    
                    <div style="float:left">Date:</div>
                    <div style="padding: 15px; width: 250px; float:left;display:inline;"><div id="slider" style=""></div></div>
                    <button id="btn-download" style="float:left;"/>
                </div>
            </div>
        
            <ul>
                <li><a href="#frg-date"><span>Date/Time</span></a></li>
                <li><a href="#frg-bbox"><span>Bounding Box</span></a></li>
                <li><a href="#frg-info"><span>Server Info</span></a></li>
                <li><a href="#frg-help"><span>Help</span></a></li>
            </ul>
            <div id="frg-date" class="container"></div>
            <div id="frg-bbox" class="container"></div>
            <div id="frg-info" class="container"></div>
            <div id="frg-help" class="container"></div>
        </div>
    </script>

    <script type="text/template" id="tpl-datetime-selection">
        <div class="row">
            <div class="cell"><a>Begin Date/Time: </a></div>
            <div class="cell"><input type="text" id="inp-begin-date" size="10" maxlength="10"></input></div>
            <div class="cell"><input type="text" id="inp-begin-time" size="10" maxlength="10"></input></div>
        </div>
        
        <div class="row">
            <div class="cell"><a>End Date/Time: </a></div>
            <div class="cell"><input type="text" id="inp-end-date" size="10" maxlength="10"></input></div>
            <div class="cell"><input type="text" id="inp-end-time" size="10" maxlength="10"></input></div>
        </div>
    </script>

    <script type="text/template" id="tpl-bbox-selection">
        <div id="fragment-bbox" class="container">
            <div class="row">
                <div class="cell"><label for="minx">Min X:</label><input type="text" id="minx" size="12" maxlength="12"></input></div>
                <div class="cell"><label for="maxx">Max X:</label><input type="text" id="maxx" size="12" maxlength="12"></input></div>
            </div>
            <div class="row">
                <div class="cell"><label for="miny">Min Y:</label><input type="text" id="miny" size="12" maxlength="12"></input></div>
                <div class="cell"><label for="maxy">Max Y:</label><input type="text" id="maxy" size="12" maxlength="12"></input></div>
            </div>
            <div class="row">
                <div class="cell">
                    <label for="chk-draw-bbox">Draw BBOX</label>
                    <input type="checkbox" id="chk-draw-bbox"/>
                </div>
                <div class="cell"><button id="btn-clear-bbox" /></div>
            </div>
            <div class="row">
                
            </div>
        </div>
    </script>

    <script type="text/template" id="tpl-help">
    </script>

    <script type="text/template" id="tpl-server-info">
        <div id="acc-info">
            <h3><a href="#">Service Identification</a></h3>
            <div>
                <% _.each(serviceIdentification, function(value, key) {%>
                <div class="row">
                    <div class="cell"><%= key %></div>
                    <div class="cell"><p><%= value %></p></div>
                </div>
                <% }); %>
            </div>
            <h3><a href="#">Service Provider</a></h3>
            <div>
                <% _.each(serviceProvider, function(value, key) {%>
                <div class="row">
                    <div class="cell"><%= key %></div>
                    <div class="cell"><p><%= value %></p></div>
                </div>
                <% }); %>
            </div>
        </div>
    </script>
    
    <script type="text/template" id="tpl-download-selection">
        <div id="coverages"></div>
        <select class="formats">
            <!-- do this dynamically once the formatsSupported works -->
            <option value="image/tiff" selected>image/tiff</option>
            <option value="image/jp2">image/jp2</option>
        </select>
        <div id="div-downloads"></div>
    </script>

    <script type="text/template" id="tpl-download-selection-item">
        <input type="checkbox" checked="true" class="chk-selected" style="float:left;"/>
        <div style="clear:right;max-width:40em;overflow:hidden;"><%= coverageId %></div>
        Width:<input type="text" class="sizex" size="5" maxlength="5" <%= (coverageSubtype === "ReferenceableDataset") ? 'disabled="disabled"' : "" %>/>
        Height:<input type="text" class="sizey" size="5" maxlength="5" <%= (coverageSubtype === "ReferenceableDataset") ? 'disabled="disabled"' : "" %>/>
        CRS:<select class="crs">
            <option value="http://www.opengis.net/def/crs/EPSG/0/4326" selected>EPSG:4326</option>
        </select>
        
        <input type="button" class="btn-select-rangetype" value="Select Bands"></input>
        <input type="button" class="btn-show-info" value="Show Info"></input>
    </script>

    <!-- use this template once supportedCRSs are working as expected -->
    <!--<script type="text/template" id="tpl-download-selection-item">
        <input type="checkbox" checked="true" class="chk-selected" style="float:left;"/>
        <div style="clear:right;"><%= coverageId %></div>
        Width:<input type="text" class="sizex" size="5" maxlength="5"/>
        Height:<input type="text" class="sizey" size="5" maxlength="5"/>
        CRS:<select class="crs">
            <% _.each(supportedCRSs, function(crs) { %>
                <option value="<%= crs %>" <%= (crs === nativeCRS) ? "selected": "" %>><%= crs %></option>
            <% }); %>
        </select>
        
        <input type="button" class="btn-select-rangetype" value="Select Bands"></input>
        <input type="button" class="btn-show-info" value="Show Info"></input>
    </script>-->

    <script type="text/template" id="tpl-rangetype-selection">
        <% _.each(rangeType, function(band) { %>
            <tr>
                <td><input type="checkbox" <%= (band.selected) ? "checked" : "" %>><%= band.name %> </input></td>
            </tr>
        <% }); %>
    </script>

    <script type="text/template" id="tpl-coverage-info">
        <table>
            <tr>
                <td>Coverage ID</td>
                <td><%= coverageId %></td>
            </tr>
            <tr>
                <td>Origin</td>
                <td><%= origin[0] %> <%= origin[1] %></td>
            </tr>
            <tr>
                <td></td>
                <td><%= null%></td>
            </tr>
        </table>
        
    </script>

    <div id="div-map" style="position:absolute;top:0px;left:0px;padding:0;margin:0;height:100%;width:100%;min-height:450px;min-width:600px;z-index:1;"></div>
    <div id="div-main"></div>
    <div id="div-download"></div>
    <div id="div-tooltip" class="ui-widget tooltip"><a></a></div>
    <div id="div-busy-indicator" class="ui-widget ui-widget-content ui-corner-all">
        <img src="{{STATIC_URL}}ajax-loader.gif"></img>
    </div>

    <script src="{{STATIC_URL}}OpenLayers/OpenLayers.js"></script>
    <script src="{{STATIC_URL}}jquery/jquery.min.js"></script>
    <script src="{{STATIC_URL}}jquery/jquery-ui.min.js"></script>
    <script src="{{STATIC_URL}}jquery/jquery.maskedinput.min.js"></script>
    <script src="http://www.rfk.id.au/static/scratch/jquery.xmlns.js" type="text/javascript"></script>
    <script src="{{STATIC_URL}}underscore.js"></script>
    <script src="{{STATIC_URL}}backbone.js"></script>
    <script src="{{STATIC_URL}}libcoverage.js/libcoverage.wcs.js" type="text/javascript"></script>
    <script src="{{STATIC_URL}}libcoverage.js/libcoverage.eowcs.js" type="text/javascript"></script>
    <script src="{{STATIC_URL}}libcoverage.js/integrations/libcoverage.backbone.js" type="text/javascript"></script>
    <script src="{{STATIC_URL}}App/views.js" type="text/javascript"></script>

    <script type="text/javascript">

$(document).ready(function() {
    var timeRex = /([0-9]{1,2}):([0-9]{1,2})/, match;
    var minDate = $.datepicker.parseDate("yy-mm-dd", "{{begin.date}}");
    var maxDate = $.datepicker.parseDate("yy-mm-dd", "{{end.date}}");

    match = timeRex.exec("{{begin.time}}");

    minDate.setHours(match[1]);
    minDate.setMinutes(match[2]);

    match = timeRex.exec("{{end.time}}");
    
    maxDate.setHours(match[1]);
    maxDate.setMinutes(match[2]);

    var app = new App.Router({
        minDate: minDate,
        maxDate: maxDate,
        extent: [{{extent}}],
        eoid: "{{eoid}}",
        owsUrl: "{{ows_url}}",
        layerParams: [{
            name: "{{eoid}} Preview",
            layerId: "{{eoid}}",
            service: "{{preview_service}}",
            url: "{{preview_url}}"
        }, {
            name: "{{eoid}} Outlines",
            layerId: "{{eoid}}_outlines",
            service: "{{outline_service}}",
            url: "{{outline_url}}"
        }]
    });
    Backbone.history.start();
});

    </script>

  </body>
</html>
