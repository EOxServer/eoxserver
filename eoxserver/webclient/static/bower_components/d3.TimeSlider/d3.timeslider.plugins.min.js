/* D3.TimeSlider - version 0.0.13 - 2014-03-04
 * See https://github.com/EOX-A/d3.TimeSlider for more information! */
(function(){TimeSlider.Plugin.EOWCS=function(){function a(a){var b,c=this;return this.options=null!=a?a:{},this.formatDate=function(a){return a.toISOString().substring(0,19)+"Z"},b=function(a,b,d){var e;return e=d3.xhr(WCS.EO.KVP.describeEOCoverageSetURL(c.options.url,c.options.eoid,{subsetTime:[c.formatDate(a),c.formatDate(b)]})),e.get(function(a,b){var e,f,g,h,i;if(a&&d(c.options.dataset,[]),f=[],b=WCS.Core.Parse.parse(b.responseXML),null!=b.coverageDescriptions&&b.coverageDescriptions.length>0)for(i=b.coverageDescriptions,g=0,h=i.length;h>g;g++)e=i[g],f.push([new Date(e.timePeriod[0]),new Date(e.timePeriod[1])]);return d(c.options.dataset,f)})}}return a}(),TimeSlider.Plugin.WMS=function(){function a(a){var b,c=this;return this.options=null!=a?a:{},b=function(a,b,d){return"undefined"!=typeof JSON&&null!==JSON&&(c.data=JSON.parse(localStorage.getItem(c.options.url))),null==c.data?d3.xml(""+c.options.url+"?service=wms&request=getCapabilities","application/xml",function(a,b){var e,f,g,h,i,j,k;if(null==c.data&&(c.data={layers:{},reloaded_at:null}),!a){for(c.data.reloaded_at=new Date,h=d3.select(b),k=h.selectAll('Layer > Dimension[name="time"]')[0],i=0,j=k.length;j>i;i++)f=k[i],g=d3.select(f.parentNode).select("Name").text(),e=d3.select(f).text().split(","),c.data.layers[g]=e;return"undefined"!=typeof JSON&&null!==JSON&&localStorage.setItem(c.options.url,JSON.stringify(c.data)),d(c.options.dataset,c.data.layers[c.options.eoid])}}):d(c.options.dataset,c.data.layers[c.options.eoid])}}return a}(),TimeSlider.Plugin.WPS=function(){function a(a){var b,c=this;return this.options=null!=a?a:{},this.formatDate=function(a){return a.toISOString().substring(0,19)+"Z"},this.current_bbox=this.options.bbox,this.current_data=null,this.current_start=new Date,this.current_end=new Date,b=function(a,b,d,e){var f,g,h,i,j,k,l,m,n;if(c.current_start.getTime()!==a.getTime()&&c.current_end.getTime()!==b.getTime())return j='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n  <ows:Identifier>getTimeData</ows:Identifier>\n  <wps:DataInputs>\n    <wps:Input>\n      <ows:Identifier>collection</ows:Identifier>\n      <wps:Data>\n        <wps:LiteralData>'+c.options.eoid+"</wps:LiteralData>\n      </wps:Data>\n    </wps:Input>\n    <wps:Input>\n      <ows:Identifier>begin_time</ows:Identifier>\n      <wps:Data>\n        <wps:LiteralData>"+c.formatDate(a)+"</wps:LiteralData>\n      </wps:Data>\n    </wps:Input>\n    <wps:Input>\n      <ows:Identifier>end_time</ows:Identifier>\n      <wps:Data>\n        <wps:LiteralData>"+c.formatDate(b)+'</wps:LiteralData>\n      </wps:Data>\n    </wps:Input>\n  </wps:DataInputs>\n  <wps:ResponseForm>\n    <wps:RawDataOutput mimeType="text/plain">\n      <ows:Identifier>times</ows:Identifier>\n    </wps:RawDataOutput>\n  </wps:ResponseForm>\n</wps:Execute>',k=d3.csv(c.options.url),k.post(j,function(f,g){var h,i,j,k,l,m;for(f&&d(c.options.dataset,[]),j=[],l=0,m=g.length;m>l;l++)i=g[l],k=!1,c.current_bbox?(h=i.bbox.replace(/[()]/g,"").split(",").map(parseFloat),c.current_bbox[0]>h[2]||c.current_bbox[2]<h[0]||c.current_bbox[3]<h[1]||c.current_bbox[1]>h[3]||(k=!0)):k=!0,j.push([new Date(i.starttime),new Date(i.endtime),i.identifier,i.bbox,k]);return c.current_data=j,c.current_bbox=e,c.current_start=a,c.current_end=b,d(c.options.dataset,j)});for(h=[],n=c.current_data,l=0,m=n.length;m>l;l++)g=n[l],i=!1,f=g[3].replace(/[()]/g,"").split(",").map(parseFloat),c.current_bbox?e[0]>f[2]||e[2]<f[0]||e[3]<f[1]||e[1]>f[3]||(i=!0):i=!0,h.push([new Date(g[0]),new Date(g[1]),g[2],g[3],i]);return c.current_data=h,c.current_bbox=e,d(c.options.dataset,h)}}return a}()}).call(this);