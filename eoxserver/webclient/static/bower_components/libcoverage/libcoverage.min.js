/* libcoverage.js - version 0.1.5 - 2014-10-24
 * See https://github.com/EOX-A/libcoverage.js for more information! */
var namespace=function(a,b,c){var d,e,f=a.split(b||"."),g=c||window;for(d=0,e=f.length;e>d;d++)g=g[f[d]]=g[f[d]]||{};return g};namespace("WCS.Core"),WCS.Util=function(){return{objectToKVP:function(a){var b=[];for(var c in a)b.push(c+"="+a[c]);return b.join("&")},stringToIntArray:function(a,b){return b=b||" ",WCS.Util.map(a.split(b),function(a){return parseInt(a)})},stringToFloatArray:function(a,b){return b=b||" ",WCS.Util.map(a.split(b),function(a){return parseFloat(a)})},getFirst:function(a,b,c){return c?b?a.getElementsByTagNameNS(b,c)[0]:a.getElementsByTagName(c)[0]:a},getText:function(a,b,c,d){var e=WCS.Util.getFirst(a,b,c);return e?e.textContent:d},getAll:function(a,b,c){return c?b?a.getElementsByTagNameNS(b,c):a.getElementsByTagName(c):[a]},getTextArray:function(a,b,c){for(var d=[],e=WCS.Util.getAll(a,b,c),f=0;f<e.length;++f)d.push(e[f].textContent);return d},map:function(a,b){for(var c=[],d=0;d<a.length;++d)c.push(b(a[d]));return c},deepMerge:function(a,b){if("object"==typeof a&&"object"==typeof b)for(var c in b)a.hasOwnProperty(c)&&"object"==typeof a[c]&&"object"==typeof b[c]?WCS.Util.deepMerge(a[c],b[c]):a[c]=b[c]}}}(),WCS.Core.KVP=function(){return{getCapabilitiesURL:function(a,b,c){if(!a)throw new Error("Parameter 'url' is mandatory.");b=b||{},c=c||{};var d=["service=wcs","version=2.0.0","request=getcapabilities"];b.updatesequence&&d.push("updatesequence="+b.updatesequence),b.sections&&d.push("sections="+b.sections.join(","));var e=WCS.Util.objectToKVP(c);return a+("?"!==a.charAt(a.length-1)?"?":"")+d.join("&")+(e.length>0?"&"+e:"")},describeCoverageURL:function(a,b,c){if(!a||!b)throw new Error("Parameters 'url' and 'coverageids' are mandatory.");var d=["service=wcs","version=2.0.0","request=describecoverage"];c=c||{},d.push("coverageid="+("string"==typeof b?b:b.join(",")));var e=WCS.Util.objectToKVP(c);return a+("?"!==a.charAt(a.length-1)?"?":"")+d.join("&")+(e.length>0?"&"+e:"")},getCoverageURL:function(a,b,c,d){if(!a||!b)throw new Error("Parameters 'url' and 'coverageid' are mandatory.");c=c||{},subsetCRS=c.subsetCRS||"http://www.opengis.net/def/crs/EPSG/0/4326","?"!==a.charAt(a.length-1)&&(a+="?");var e=["service=wcs","version=2.0.0","request=getcoverage","coverageid="+b];c.format&&e.push("format="+c.format),!c.bbox||c.subsetX||c.subsetY||(c.subsetX=[c.bbox[0],c.bbox[2]],c.subsetY=[c.bbox[1],c.bbox[3]]),c.subsetX&&e.push("subset=x("+c.subsetX[0]+","+c.subsetX[1]+")"),c.subsetY&&e.push("subset=y("+c.subsetY[0]+","+c.subsetY[1]+")"),c.subsetCRS&&e.push("subsettingCrs="+subsetCRS),!c.size||c.sizeX||c.sizeY||(c.sizeX=c.size[0],c.sizeY=c.size[1]);var f=[];c.sizeX&&f.push("x("+c.sizeX+")"),c.sizeY&&f.push("y("+c.sizeY+")"),f.length>0&&e.push("scalesize="+f.join(",")),!c.resolution||c.resolutionX||c.resolutionY||(c.resolutionX=c.resolution[0],c.resolutionY=c.resolution[1]),c.rangeSubset&&e.push("rangesubset="+c.rangeSubset.join(",")),c.interpolation&&e.push("interpolation="+c.interpolation),c.outputCRS&&e.push("outputcrs="+c.outputCRS),c.multipart&&e.push("mediatype=multipart/mixed");var g=WCS.Util.objectToKVP(d);return a+("?"!==a.charAt(a.length-1)?"?":"")+e.join("&")+(g.length>0?"&"+g:"")}}}(),WCS.Core.Parse=function(){var a;"undefined"!=typeof window.DOMParser?a=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(a=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b});var b={},c={xlink:"http://www.w3.org/1999/xlink",ows:"http://www.opengis.net/ows/2.0",wcs:"http://www.opengis.net/wcs/2.0",gml:"http://www.opengis.net/gml/3.2",gmlcov:"http://www.opengis.net/gmlcov/1.0",swe:"http://www.opengis.net/swe/2.0",crs:"http://www.opengis.net/wcs/crs/1.0"},d=function(a,c){b.hasOwnProperty(a)?b[a].push(c):b[a]=[c]},e=function(a){for(var b in a)d(b,a[b])},f=function(a,c){if(b.hasOwnProperty(a)){for(var d=b[a],e={},f=0;f<d.length;++f){var g=d[f](c);WCS.Util.deepMerge(e,g)}return e}throw new Error("No parsing function for tag name '"+a+"' registered.")},g={throwOnException:!1},h=WCS.Util.getFirst,i=WCS.Util.getText,j=WCS.Util.getAll,k=WCS.Util.getTextArray,l=WCS.Util.map,m=function(b){var c;return c="string"==typeof b?a(b).documentElement:b.documentElement,WCS.Core.Parse.callParseFunctions(c.localName,c)},n=function(a){var b=h(a,c.ows,"Exception"),d={code:b.getAttribute("exceptionCode"),locator:b.getAttribute("locator"),text:i(b,c.ows,"ExceptionText")};if(g.throwOnException)throw new Exception(d.text);return d},o=function(a){var b=h(a,c.ows,"ServiceIdentification"),d=h(a,c.ows,"ServiceProvider"),e=h(a,c.wcs,"ServiceMetadata"),f=h(d,c.ows,"Phone"),g=h(d,c.ows,"Address");return{serviceIdentification:{title:i(b,c.ows,"Title"),"abstract":i(b,c.ows,"Abstract"),keywords:k(b,c.ows,"Keyword"),serviceType:i(b,c.ows,"ServiceType"),serviceTypeVersion:i(b,c.ows,"ServiceTypeVersion"),profiles:k(b,c.ows,"Profile"),fees:i(b,c.ows,"Fees"),accessConstraints:i(b,c.ows,"AccessConstraints")},serviceProvider:{providerName:i(d,c.ows,"ProviderName"),providerSite:h(d,c.ows,"ProviderSite").getAttributeNS(c.xlink,"href"),individualName:i(d,c.ows,"IndividualName"),positionName:i(d,c.ows,"PositionName"),contactInfo:{phone:{voice:i(f,c.ows,"Voice"),facsimile:i(f,c.ows,"Facsimile")},address:{deliveryPoint:i(g,c.ows,"DeliveryPoint"),city:i(g,c.ows,"City"),administrativeArea:i(g,c.ows,"AdministrativeArea"),postalCode:i(g,c.ows,"PostalCode"),country:i(g,c.ows,"Country"),electronicMailAddress:i(g,c.ows,"ElectronicMailAddress")},onlineResource:h(d,c.ows,"OnlineResource").getAttributeNS(c.xlink,"href"),hoursOfService:i(d,c.ows,"HoursOfService"),contactInstructions:i(d,c.ows,"ContactInstructions")},role:i(d,c.ows,"Role")},serviceMetadata:{formatsSupported:k(e,c.wcs,"formatSupported"),crssSupported:k(e,c.crs,"crsSupported")},operations:l(j(a,c.ows,"Operation"),function(a){return{name:a.getAttribute("name"),getUrl:h(a,c.ows,"Post").getAttributeNS(c.xlink,"href"),postUrl:h(a,c.ows,"Get").getAttributeNS(c.xlink,"href")}}),contents:{coverages:l(j(a,c.wcs,"CoverageSummary"),function(a){return{coverageId:i(a,c.wcs,"CoverageId"),coverageSubtype:i(a,c.wcs,"CoverageSubtype")}})}}},p=function(a){var b=l(j(a,c.wcs,"CoverageDescription"),function(a){return WCS.Core.Parse.callParseFunctions(a.localName,a)});return{coverageDescriptions:b}},q=function(a){for(var b=h(a,c.gml,"Envelope"),d=h(a,c.gml,"domainSet"),e=WCS.Util.stringToIntArray(i(d,c.gml,"low")),f=WCS.Util.stringToIntArray(i(d,c.gml,"high")),g=[],m=0;m<Math.min(e.length,f.length);++m)g.push(f[m]+1-e[m]);var n=i(d,c.gml,"pos");if(n)var o=WCS.Util.stringToFloatArray(n);for(var p=l(j(d,c.gml,"offsetVector"),function(a){return WCS.Util.stringToFloatArray(i(a))}),q=[],m=0;m<p.length;++m)for(var r=0;r<p.length;++r)0!=p[r][m]&&q.push(p[r][m]);var s=h(a,c.gml,"RectifiedGrid");s||(s=h(a,c.gml,"ReferenceableGrid"));var t={coverageId:i(a,c.wcs,"CoverageId"),dimensions:parseInt(s.getAttribute("dimension")),bounds:{projection:b.getAttribute("srsName"),lower:WCS.Util.stringToFloatArray(i(b,c.gml,"lowerCorner")),upper:WCS.Util.stringToFloatArray(i(b,c.gml,"upperCorner"))},envelope:{low:e,high:f},size:g,origin:o,offsetVectors:p,resolution:q,rangeType:l(j(a,c.swe,"field"),function(a){return{name:a.getAttribute("name"),description:i(a,c.swe,"description"),uom:h(a,c.swe,"uom").getAttribute("code"),nilValues:l(j(a,c.swe,"nilValue"),function(a){return{value:parseInt(a.textContent),reason:a.getAttribute("reason")}}),allowedValues:WCS.Util.stringToIntArray(i(a,c.swe,"interval")),significantFigures:parseInt(i(a,c.swe,"significantFigures"))}}),coverageSubtype:i(a,c.wcs,"CoverageSubtype"),supportedCRSs:k(a,c.wcs,"supportedCRS"),nativeCRS:i(a,c.wcs,"nativeCRS"),supportedFormats:k(a,c.wcs,"supportedFormat")};return t};e({Capabilities:o,ExceptionReport:n,CoverageDescriptions:p,CoverageDescription:q,RectifiedGridCoverage:q});var r={pushParseFunction:d,pushParseFunctions:e,parse:m,callParseFunctions:f,options:g};return r}(),namespace("WCS.EO"),WCS.EO.KVP=function(){return{describeEOCoverageSetURL:function(a,b,c,d){if(!a||!b)throw new Error("Parameters 'url' and 'eoid' are mandatory.");c=c||{},d=d||{};var e=["service=wcs","version=2.0.0","request=describeeocoverageset","eoid="+b];!c.bbox||c.subsetX||c.subsetY||(c.subsetX=[c.bbox[0],c.bbox[2]],c.subsetY=[c.bbox[1],c.bbox[3]]),c.subsetX&&e.push("subset=x("+c.subsetX[0]+","+c.subsetX[1]+")"),c.subsetY&&e.push("subset=y("+c.subsetY[0]+","+c.subsetY[1]+")"),c.subsetTime&&e.push('subset=phenomenonTime("'+c.subsetTime[0]+'","'+c.subsetTime[1]+'")'),c.containment&&e.push("containment="+c.containment),c.count&&e.push("count="+c.count),c.sections&&e.push("sections="+c.sections.join(","));var f=WCS.Util.objectToKVP(d);return a+("?"!==a.charAt(a.length-1)?"?":"")+e.join("&")+(f.length>0?"&"+f:"")}}}(),WCS.EO.Parse=function(){var a={wcs:"http://www.opengis.net/wcs/2.0",gml:"http://www.opengis.net/gml/3.2",eop:"http://www.opengis.net/eop/2.0",wcseo:"http://www.opengis.net/wcseo/1.0",om:"http://www.opengis.net/om/2.0"},b=WCS.Util.getFirst,c=WCS.Util.getText,d=WCS.Util.getAll,e=(WCS.Util.getTextArray,WCS.Util.map);return{parseEOCoverageSetDescription:function(c){var d=b(c,a.wcs,"CoverageDescriptions"),e=d?WCS.Core.Parse.callParseFunctions("CoverageDescriptions",d):[],f=b(c,a.wcseo,"DatasetSeriesDescriptions"),g=f?WCS.Core.Parse.callParseFunctions("DatasetSeriesDescriptions",f):[];return{coverageDescriptions:e.coverageDescriptions,datasetSeriesDescriptions:g.datasetSeriesDescriptions}},parseDatasetSeriesDescriptions:function(b){var c=e(d(b,a.wcseo,"DatasetSeriesDescription"),function(a){return WCS.Core.Parse.callParseFunctions("DatasetSeriesDescription",a)});return{datasetSeriesDescriptions:c}},parseDatasetSeriesDescription:function(){return{}},parseExtendedCapabilities:function(b){return{contents:{datasetSeries:e(d(b,a.wcseo,"DatasetSeriesSummary"),function(b){return{datasetSeriesId:c(b,a.wcseo,"DatasetSeriesId"),timePeriod:[new Date(c(b,a.gml,"beginPosition")),new Date(c(b,a.gml,"endPosition"))]}})}}},parseExtendedCoverageDescription:function(d){var e=b(d,a.wcseo,"EOMetadata");if(e){var f=b(e,a.om,"phenomenonTime"),g=b(e,a.om,"featureOfInterest");return{footprint:WCS.Util.stringToFloatArray(c(g,a.gml,"posList")),timePeriod:[new Date(c(f,a.gml,"beginPosition")),new Date(c(f,a.gml,"endPosition"))]}}return{}}}}(),WCS.Core.Parse.pushParseFunctions({EOCoverageSetDescription:WCS.EO.Parse.parseEOCoverageSetDescription,DatasetSeriesDescriptions:WCS.EO.Parse.parseDatasetSeriesDescriptions,DatasetSeriesDescription:WCS.EO.Parse.parseDatasetSeriesDescription,Capabilities:WCS.EO.Parse.parseExtendedCapabilities,CoverageDescription:WCS.EO.Parse.parseExtendedCoverageDescription});